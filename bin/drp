# read main configuration file
# overwrite config object with cmdline arguments
# read latest record in DRP logs
# check for new frames
# if new frame:
#   run preprocessing (remove overscan, prescan and align amplifiers)

#   if basic calibration frame (bias, dark, flat):
#     build master
#     read current master
#     compare new to current master
#     if current master too different (from new master) or too stale: replace current master

#   if continuum/arc frame:
#     find basic calibration frames matching cont/arc if exists, else use closest in time
#     run basic calibration (bias, dark, flat)
#     if continuum:
#       cosmic ray
#       find peaks
#       1st trace
#       stray light
#       2nd trace
#       extraction
#       run continuum diagnostics, while failing:
#         use closest in time master if exists, else add continuum flag
#     if arc:
#       locate corresponding continuum, else use master
#       cosmic ray
#       stray light
#       extraction
#       run arc diagnostics, while failing:
#         use most recent master if exists, else add arc flag

#   if calibration star:
#     run basic calibration:
#        dark:
#          run dark diagnostics, while failing:
#            use most recent master if exists, else add dark flag
#        bias:
#          run bias diagnostics, while failing:
#            use most recent master if exists, else add bias flag
#        flat:
#          run flat diagnostics, while failing:
#            use most recent master if exists, else add flat flag
#     locate continuum if present, else use current master
#     locate arc if present, else use current master
#     cosmic ray
#     stray light
#     extraction
#     wavelength solution
#     fiberflat
#     join channels (if needed by sky module)
#     sky subtraction
#     flux calibration
#     run diagnostics and add corresponding flags

#   if object:
#     run basic calibration:
#        dark:
#          run dark diagnostics, while failing:
#            use most recent master if exists, else add dark flag
#        bias:
#          run bias diagnostics, while failing:
#            use most recent master if exists, else add bias flag
#        flat:
#          run flat diagnostics, while failing:
#            use most recent master if exists, else add flat flag
#     locate continuum if present, else use current master
#     locate arc if present, else use current master
#     locate corresponding calibration star, else use most recent
#     cosmic ray
#     stray light
#     extraction
#     wavelength solution
#     fiberflat
#     join channels (if needed by sky module)
#     sky subtraction
#     flux calibration
#     run diagnostics and add corresponding flags

#   write logs